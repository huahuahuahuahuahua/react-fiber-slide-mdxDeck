import {
  CodeSurfer,
  CodeSurferColumns,
  Step,
} from "code-surfer";
import {
  github,
  vsDark,
  nightOwl,
} from "@code-surfer/themes";
import Fiber1 from "./image/image-20220514182437794.png";
export const theme = vsDark;

<Head>
  <title>React fiber 简单了解</title>
</Head>

# React 16 Fiber 的简单了解

---

<CodeSurferColumns themes={[vsDark, github]}>

<Step>

```js 2:4,5,11 file=./src/jsxdom.js title="DOM Elements"

```

```js 1,3 file=./src/HTMLDOM.js title="HTML片段"

```

</Step>
<Step>

```js file=./src/jsxdom.js title="DOM Elements"

```

```js file=./src/HTMLDOM.js title="HTML片段"

```

</Step>

</CodeSurferColumns>

---

<CodeSurferColumns >

<Step>

```js file=./src/StackReconciler.js title="React 15 栈协调更新机制（伪代码）"

```

</Step>

<Step>

```js 2[2:18],4[4:24],6[2:18] file=./src/StackReconciler.js

```

</Step>

<Step>

```js 26:35,36[5] file=./src/StackReconciler.js

```

</Step>

<Step>

```js file=./src/StackReconciler.js title="React 15 栈协调更新机制（伪代码）"

```

</Step>

</CodeSurferColumns>

---

### React 15 stack Reconciler 的缺点

- 如果当前组件层次非常深，那么组件更新耗时非常长

- 对于动画场景而言，如果一帧时间超过 16ms，就会出现掉帧，动画不流畅

- 低优先级的组件（比如隐藏，屏幕外），也会占用更新资源，没有优先级之分

---

# what is Fiber

### Fiber 的中文翻译叫纤程，与进程、线程同为程序执行过程，

### 比线程还要纤细的一个过程。

---

# Fiber 的结构

<Split>

<img src={Fiber1} />

### 增加了

### 双向箭头

### 指向兄弟姐妹的箭头

</Split>

---

# Fiber 核心架构可以分为三层：

##### <span style={{color: "yellow"}}>Scheduler 调度器 </span> - 调度任务的优先级

##### <span style={{color: "yellow"}}>Reconciler 协调器</span> - 负责找出变化的组件

##### <span style={{color: "yellow"}}>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Renderer 渲染器 </span> - 负责将变化的组件渲染到页面上

---

<CodeSurferColumns themes={[vsDark, github]}>

<Step>

```js file=./src/workloop.js title="Work Loop（伪代码）"

```

</Step>

<Step>

```js 9:12 file=./src/workloop.js title="Work Loop"

```

</Step>

<Step>

```js 4:8 file=./src/workloop.js title="Work Loop"

```

</Step>

<Step>

```js file=./src/workloop.js title="Work Loop"

```

</Step>

</CodeSurferColumns>

---

<CodeSurferColumns themes={[vsDark, github]} sizes={[1, 1]}>

<Step>

<img
  width={500}
  height={800}
  style={{ display: "table-cell" }}
  src="https://s27.aconvert.com/convert/p3r68-cdx67/tv0uv-bmmrz.gif"
/>

```js 2,9:12 file=./src/workloop.js title="Work Loop"

```

</Step>

</CodeSurferColumns>

---

docs:[codesurfer.pomb.us](https://codesurfer.pomb.us)

github:[mdx-deck-slide-decks](https://github.com/huahuahuahuahuahua/mdx-deck-slide-decks)

page:[huawink.fun](http://huawink.fun/)
